services:
  # Redis for SearXNG caching and rate limiting
  redis-searxng:
    image: redis:7-alpine
    restart: unless-stopped
    command: ["redis-server", "--appendonly", "no"]
    networks:
      - mcp-network
    profiles: ["mcp", "mcp-full"]

  # SearXNG - Meta Search Engine (HTTP on 8080 inside container)
  searxng:
    image: searxng/searxng:latest
    restart: unless-stopped
    environment:
      # External base URL for correct link generation; adjust if needed
      SEARXNG_BASE_URL: http://localhost:8086/
      # Use the companion redis instance
      SEARXNG_REDIS_URL: redis://redis-searxng:6379/0
      # Optional: enable suggestion backends, safe search, etc. via settings
      # See: https://docs.searxng.org/admin/engines/settings.html
    depends_on:
      - redis-searxng
    ports:
      - "8086:8080"
    networks:
      - mcp-network
    profiles: ["mcp", "mcp-full"]

  # Lightweight vector store for MCP file search
  vector-store-mcp:
    build: ./services/mcp-tools/tools/vector-store-service
    restart: unless-stopped
    environment:
      VECTOR_STORE_PORT: 3015
    ports:
      - "3015:3015"
    networks:
      - mcp-network
    profiles: ["mcp", "mcp-full"]

  # SandboxFusion code interpreter
  sandbox-fusion:
    image: volcengine/sandbox-fusion:server-20250609
    restart: unless-stopped
    ports:
      - "3010:8080"
    networks:
      - mcp-network
    profiles: ["mcp", "mcp-full"]

networks:
  mcp-network:
    external: true
    name: jan-server_mcp-network
