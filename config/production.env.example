# Production Environment Configuration
# COPY THIS FILE TO config/production.env AND CUSTOMIZE
# NEVER COMMIT production.env TO VERSION CONTROL

# ============================================================================
# Database (Production)
# ============================================================================
# Use managed database service (RDS, Cloud SQL, Azure Database, etc.)
# Primary database for llm-api, media-api, response-api, template-api, memory-tools
DB_POSTGRESQL_WRITE_DSN=postgres://prod_user:CHANGE_ME_STRONG_PASSWORD@prod-db.example.com:5432/jan_llm_api?sslmode=require

# Optional: Read replica for scaling read operations
# DB_POSTGRESQL_READ1_DSN=postgres://prod_user:CHANGE_ME_STRONG_PASSWORD@prod-db-replica.example.com:5432/jan_llm_api?sslmode=require

# Memory Tools Database (can use same database or separate)
MEMORY_DB_POSTGRESQL_WRITE_DSN=${DB_POSTGRESQL_WRITE_DSN}
# MEMORY_DB_POSTGRESQL_READ1_DSN=${DB_POSTGRESQL_READ1_DSN}

# Optional: Read replica for scaling read operations
# DB_POSTGRESQL_READ1_DSN=postgres://prod_user:CHANGE_ME_STRONG_PASSWORD@prod-db-replica.example.com:5432/jan_llm_api?sslmode=require

# Memory Tools Database (can use same database or separate)
MEMORY_DB_POSTGRESQL_WRITE_DSN=${DB_POSTGRESQL_WRITE_DSN}
# MEMORY_DB_POSTGRESQL_READ1_DSN=${DB_POSTGRESQL_READ1_DSN}

# PostgreSQL container settings (for local docker)
POSTGRES_USER=prod_user
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD
POSTGRES_DB=jan_llm_api

# ============================================================================
# Authentication (Production Keycloak)
# ============================================================================
KEYCLOAK_BASE_URL=https://auth.yourdomain.com
JWKS_URL=https://auth.yourdomain.com/realms/jan/protocol/openid-connect/certs
ISSUER=https://auth.yourdomain.com/realms/jan
OAUTH_REDIRECT_URI=https://api.yourdomain.com/auth/callback
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=CHANGE_ME_STRONG_PASSWORD
KEYCLOAK_REALM=jan
ACCOUNT=account
REFRESH_JWKS_INTERVAL=5m

# Guest provisioning
BACKEND_CLIENT_ID=backend
BACKEND_CLIENT_SECRET=CHANGE_ME_STRONG_PASSWORD
CLIENT=jan-client
GUEST_ROLE=guest

# ============================================================================
# API Service
# ============================================================================
HTTP_PORT=8080
LOG_LEVEL=info
LOG_FORMAT=json
AUTO_MIGRATE=false  # Run migrations separately in production

# ============================================================================
# Kong API Gateway
# ============================================================================
KONG_HTTP_PORT=8000

# ============================================================================
# vLLM Inference
# ============================================================================
VLLM_PORT=8101
VLLM_MODEL=Qwen/Qwen2.5-3B-Instruct-AWQ
VLLM_SERVED_NAME=qwen2.5-3b-instruct-awq
VLLM_GPU_UTIL=0.95
VLLM_INTERNAL_KEY=CHANGE_ME_STRONG_PASSWORD

# Model provider
MODEL_PROVIDER_SECRET=CHANGE_ME_STRONG_PASSWORD
JAN_PROVIDER_CONFIGS=true
JAN_PROVIDER_CONFIGS_FILE=config/providers.yml
JAN_PROVIDER_CONFIG_SET=production
# Legacy fallback (single provider)
# JAN_DEFAULT_NODE_SETUP=true
# JAN_DEFAULT_NODE_URL=https://inference.yourdomain.com/v1
# JAN_DEFAULT_NODE_API_KEY=${VLLM_INTERNAL_KEY}

# ============================================================================
# MCP Tools Service
# ============================================================================
MCP_TOOLS_HTTP_PORT=8091

# Search configuration
SEARCH_ENGINE=serper
SERPER_DOMAIN_FILTER=
SERPER_LOCATION_HINT=
SERPER_OFFLINE_MODE=false

# MCP Provider URLs (Production - use HTTPS)
SEARXNG_URL=https://search.yourdomain.com
VECTOR_STORE_URL=https://vector.yourdomain.com
SANDBOXFUSION_URL=https://sandbox.yourdomain.com
SANDBOX_FUSION_REQUIRE_APPROVAL=true
MCP_ENABLE_PYTHON_EXEC=true
MCP_ENABLE_MEMORY_RETRIEVE=true

# Browser automation
CODE_SANDBOX_ENABLED=true
CODE_SANDBOX_URL=https://code-sandbox.yourdomain.com/mcp
PLAYWRIGHT_ENABLED=true
PLAYWRIGHT_URL=https://playwright.yourdomain.com

# MCP debugging (disable in production)
MCP_PROVIDER_DEBUG=false

# ============================================================================
# Memory Tools Service
# ============================================================================
MEMORY_TOOLS_PORT=8090

# Embedding Service (BGE-M3)
EMBEDDING_SERVICE_URL=http://bge-m3:8091

# Embedding Cache Configuration
EMBEDDING_CACHE_TYPE=redis  # Options: redis, memory, noop
EMBEDDING_CACHE_REDIS_URL=redis://redis:6379/3
EMBEDDING_CACHE_KEY_PREFIX=emb:
EMBEDDING_CACHE_MAX_SIZE=10000
EMBEDDING_CACHE_TTL=1h

# Logging
MEMORY_LOG_LEVEL=info
MEMORY_LOG_FORMAT=json

# ============================================================================
# Media API - S3 Storage Configuration
# ============================================================================
# S3-compatible storage for media uploads (AWS S3, MinIO, etc.)
MEDIA_S3_ENDPOINT=https://s3.amazonaws.com
MEDIA_S3_REGION=us-east-1
MEDIA_S3_BUCKET=jan-production-media
MEDIA_S3_ACCESS_KEY_ID=CHANGE_ME_AWS_ACCESS_KEY_ID
MEDIA_S3_SECRET_ACCESS_KEY=CHANGE_ME_AWS_SECRET_ACCESS_KEY
MEDIA_S3_USE_PATH_STYLE=false
MEDIA_S3_PRESIGN_TTL=5m

# ============================================================================
# Observability (Production)
# ============================================================================
OTEL_ENABLED=true
OTEL_SERVICE_NAME=llm-api
OTEL_EXPORTER_OTLP_ENDPOINT=https://otel-collector.yourdomain.com:4318
OTEL_HTTP_PORT=4318
OTEL_GRPC_PORT=4317

# Monitoring stack
PROMETHEUS_PORT=9090
JAEGER_UI_PORT=16686
GRAFANA_PORT=3001
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_STRONG_PASSWORD

# ============================================================================
# Secrets (Use Secret Manager in Production)
# ============================================================================
# In production, these should come from:
# - AWS Secrets Manager
# - Azure Key Vault
# - HashiCorp Vault
# - Google Secret Manager
# - Kubernetes Secrets
#
# Examples:
# HF_TOKEN=${SECRET_MANAGER_HF_TOKEN}
# SERPER_API_KEY=${SECRET_MANAGER_SERPER_KEY}

HF_TOKEN=CHANGE_ME_USE_SECRET_MANAGER
SERPER_API_KEY=CHANGE_ME_USE_SECRET_MANAGER

# ============================================================================
# Production Checklist
# ============================================================================
# Before deploying to production:
# [ ] Change ALL passwords to strong values (20+ characters)
# [ ] Set up secret management (Vault, AWS Secrets Manager, etc.)
# [ ] Use managed database service with SSL
# [ ] Enable HTTPS for all services
# [ ] Set AUTO_MIGRATE=false (run migrations manually)
# [ ] Enable observability (OTEL_ENABLED=true)
# [ ] Set LOG_LEVEL=info (not debug)
# [ ] Use production-grade Keycloak deployment
# [ ] Configure backup strategy for database
# [ ] Set up monitoring alerts
# [ ] Review and test disaster recovery plan
# [ ] Enable rate limiting in Kong
# [ ] Configure CORS properly
# [ ] Review security headers
# [ ] Enable audit logging
# ============================================================================
