---
title: Architecture Overview
description: Jan Server system architecture, layers, request flows, and deployment modes.
full: false
---

# Architecture Overview

Jan Server is a microservices platform that exposes OpenAI-compatible APIs through Kong. This page covers the system layout, components, and operating modes. For detailed request lifecycles and network topology, see [System Design](/docs/architecture/system-design).

## System Overview

Each service owns a focused domain so teams iterate independently:

- **LLM API (8080)** - Chat completions, conversations, projects, model catalog.
- **Response API (8082)** - Multi-step orchestration and MCP tool coordination.
- **Media API (8285)** - Binary ingestion, `jan_*` IDs, presigned URL management.
- **MCP Tools (8091)** - JSON-RPC endpoint that proxies Serper/SearXNG search, scraping, file search, and SandboxFusion execution.
- **Template API (8185)** - Scaffold service template (optional).
- **Shared infrastructure** - Kong (8000), Keycloak (8085), PostgreSQL, vLLM (8101), observability stack.

Kong terminates TLS (in production), validates JWT/API keys, applies rate limits, and routes traffic to internal services.

## Architecture Layers

| Layer | Components | Responsibilities |
|-------|------------|------------------|
| **Edge** | Kong Gateway, Keycloak | Centralized auth, rate limiting, guest-token endpoint, TLS termination. |
| **Application** | LLM API, Response API, Media API, MCP Tools | Written in Go using Gin + zerolog, configured via `pkg/config`. |
| **Tooling** | SearXNG, Serper, SandboxFusion, vector-store | Only accessible from MCP Tools. |
| **Data/Storage** | PostgreSQL (`api-db`, `keycloak-db`), S3-compatible storage | Media files in object storage; metadata in PostgreSQL. |
| **Inference** | vLLM (local) or remote OpenAI-compatible providers | Selected per request using the provider metadata catalog. |
| **Observability** | OpenTelemetry Collector, Prometheus, Grafana, Jaeger | Enabled with `OTEL_ENABLED=true` + `make monitor-up`. |

## Component Diagram

```
             +------------------------------+
             |  External Clients / SDKs     |
             +---------------+--------------+
                             |
                             v
                   +-------------------+
                   |   Kong Gateway    | 8000
                   | (validates JWT)   |
                   +---+---+----+------+
                       |   |    |       \
        +--------------+   |    |        \
        |                  |    |         +------------------+
        v                  v    |                            v
  +-----------+    +---------------+      +---------------+  +-----------+
  |  LLM API  |    |  Response API |      |   Media API   |  | Keycloak  |
  | (8080)    |    |    (8082)     |      |    (8285)     |  |  (8085)   |
  +-----+-----+    +-------+-------+      +-------+-------+  | OIDC/JWT  |
        |                  |                     |            +-----------+
        |                  v                     |
        |        +-------------------+           |
        +------->|    MCP Tools      |<----------+
                 |     (8091)        |
                 +----+---+----+-----+
                      |   |    |
                      |   |    +--> SandboxFusion
                      |   +-------> Vector Store
                      +-----------> SearXNG / Serper

Infrastructure & Data:
  +-----------------+  +-----------------+  +-----------------+
  |  PostgreSQL     |  | S3 / Object     |  |   vLLM (8101)   |
  |   (api-db)      |  |    Storage      |  | Local Inference |
  +-----------------+  +-----------------+  +-----------------+

Observability Stack:
  +------------------+  +------------------+  +------------------+
  | OpenTelemetry    |  |   Prometheus     |  |    Grafana       |
  |  Collector       |  |     (9090)       |  |    (3001)        |
  |  (4317/4318)     |  | Metrics Storage  |  |  Dashboards      |
  +--------+---------+  +--------+---------+  +--------+---------+
           |                     ^                     ^
           |                     |                     |
           v                     +----------+----------+
  +------------------+                      |
  |     Jaeger       |<---------------------+
  |    (16686)       |
  |  Trace Storage   |
  +------------------+
```

## 4. How to Use This Diagram

- **Platform teams** confirm cross-service dependencies before making config changes.
- **Operators** verify port bindings and service-to-service communication for firewall rules.
- **Docs/DevRel** can link directly from high-level guides to service-specific references.

## 5. Quick Reference Tables

### Service Ports (Docker Compose defaults)

| Service | Port | Access Notes |
|---------|------|-------------|
| **Kong Gateway** | 8000 | Entry point for `/llm/*`, `/responses/*`, `/media/*`, `/mcp` (routing + auth). |
| **LLM API** | 8080 | Internal; exposed through Kong routes. |
| **Response API** | 8082 | Internal; streaming SSE via Kong `/responses`. |
| **Media API** | 8285 | Internal; proxied by Kong `/media`. |
| **MCP Tools** | 8091 | Internal; routed through Kong `/mcp`. |
| **Template API** | 8185 | Scaffold service generated from `services/template-api`. |
| **Keycloak** | 8085 | Admin console (lock down behind VPN/SSO in production). |
| **vLLM** | 8101 | Inference backend (local GPU/CPU profile). |
| **Prometheus** | 9090 | Dev-only monitoring UI (`make monitor-up`). |
| **Jaeger** | 16686 | Trace UI. |
| **Grafana** | 3001 | Dashboards (`admin/admin` in dev). |

### Technology Stack

| Component | Technology |
|-----------|------------|
| API Gateway | Kong 3.5 + `keycloak-apikey` plugin. |
| Services | Go 1.21+ (Gin, zerolog, wire DI). |
| MCP Server | mark3labs/mcp-go v0.7.0. |
| ORM | GORM + goose migrations. |
| Database | PostgreSQL 15/16 (Docker) or managed service. |
| Auth | Keycloak (OpenID Connect). |
| Inference | vLLM (OpenAI-compatible) or remote providers. |
| Observability | OpenTelemetry Collector, Prometheus, Grafana, Jaeger. |

## 6. Operating Modes

### Docker Compose (development and staging)

- `make quickstart` - Runs the interactive wizard, generates `.env`, and starts the full stack.
- `make up-full` - Boots infrastructure, APIs, MCP, and inference profiles defined in `.env`.
- `make up-api`, `make up-mcp`, `make up-gpu` - Targeted profiles for faster iteration.
- `make dev-full` - Hybrid mode that lets you run any Go service locally while Docker keeps the rest of the stack alive.

### Kubernetes (production)

- Use the Helm chart at `k8s/jan-server` for cluster installs.
- Supports managed Postgres/Redis, ingress controllers, autoscaling, and TLS termination.
- Mirrors `pkg/config` defaults so configuration drift is minimized between Compose and Kubernetes.
- See the [Deployment Guide](/docs/guides/deployment) and `k8s/SETUP.md` for complete instructions.

## 7. Continue Reading

Head to the [System Design](/docs/architecture/system-design) page for request lifecycles, network topology details, and the deployment/change-management checklist.
