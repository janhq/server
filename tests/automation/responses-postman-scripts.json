{
  "info": {
    "name": "Response API - Complete Test Suite",
    "description": "Comprehensive test suite for Response API with MCP tool orchestration, background mode, and webhook notifications",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "kong_url",
      "value": "http://localhost:8000",
      "description": "Kong Gateway base URL"
    },
    {
      "key": "guest_access_token",
      "value": ""
    },
    {
      "key": "response_id",
      "value": ""
    },
    {
      "key": "conversation_id",
      "value": ""
    },
    {
      "key": "default_model_id",
      "value": ""
    },
    {
      "key": "background_response_id",
      "value": ""
    },
    {
      "key": "long_task_response_id",
      "value": ""
    },
    {
      "key": "webhook_url",
      "value": "http://host.docker.internal:9999/test",
      "description": "Replace with your webhook endpoint"
    }
  ],
  "item": [
    {
      "name": "1. Authentication",
      "item": [
        {
          "name": "Request Guest Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}"
            },
            "url": "{{kong_url}}/auth/guest-login"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const guestData = pm.response.json();",
                  "pm.test('Guest token issued', function () {",
                  "  pm.response.to.have.status(201);",
                  "  pm.expect(guestData).to.have.property('access_token');",
                  "  pm.collectionVariables.set('guest_access_token', guestData.access_token);",
                  "});",
                  "pm.test('Response includes expiry', function () {",
                  "  pm.expect(guestData).to.have.property('expires_in');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "2. Model Catalogue",
      "item": [
        {
          "name": "List Available Models",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/v1/models",
            "description": "Fetch models from LLM API and store the first id as default."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const payload = pm.response.json();",
                  "pm.test('models request succeeded', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.expect(payload.data).to.be.an('array').that.is.not.empty;",
                  "});",
                  "const firstModel = payload.data[0];",
                  "pm.test('first model exposes id', function () {",
                  "  pm.expect(firstModel).to.have.property('id');",
                  "});",
                  "pm.collectionVariables.set('default_model_id', firstModel.id);"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "2. Health & Service Checks",
      "item": [
      {
        "name": "Response API Health",
        "request": {
          "method": "GET",
          "header": [
            {
              "key": "Authorization",
              "value": "Bearer {{guest_access_token}}"
            }
          ],
          "url": "{{kong_url}}/responses/healthz"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Health check passed', function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "MCP Tools Available",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"tools/list\",\n  \"params\": {},\n  \"id\": 1\n}"
            },
            "url": "{{mcp_tools_url}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('MCP tools listed', function () {",
                  "  pm.response.to.have.status(200);",
                  "  const body = pm.response.text();",
                  "  pm.expect(body).to.include('google_search');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "LLM API Chat Completion Smoke",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"messages\": [\n    {\"role\": \"user\", \"content\": \"Say hello from the health check.\"}\n  ],\n  \"max_tokens\": 20,\n  \"stream\": false\n}"
            },
            "url": "{{kong_url}}/v1/chat/completions"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('LLM API responded', function () {",
                  "  pm.response.to.have.status(200);",
                  "  const data = pm.response.json();",
                  "  pm.expect(data).to.have.property('choices');",
                  "  pm.expect(data.choices[0]).to.have.property('message');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "3. Basic Responses (No Tools)",
      "item": [
        {
          "name": "Create Simple Text Response",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"What is 2+2?\",\n  \"stream\": false\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Response created successfully', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.expect(response).to.have.property('id');",
                  "  pm.expect(response).to.have.property('object', 'response');",
                  "  pm.expect(response).to.have.property('status');",
                  "  pm.collectionVariables.set('response_id', response.id);",
                  "});",
                  "pm.test('Response has output', function () {",
                  "  pm.expect(response).to.have.property('output');",
                  "});",
                  "pm.test('Status is completed', function () {",
                  "  pm.expect(response.status).to.be.oneOf(['completed', 'in_progress']);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Response by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{response_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Response retrieved', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.expect(response.id).to.equal(pm.collectionVariables.get('response_id'));",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "4. Tool Calling - Google Search",
      "item": [
        {
          "name": "Create Response with Search Tool",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Search for the latest news about OpenAI and summarize the top 3 results\",\n  \"tools\": [\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"google_search\",\n        \"description\": \"Search the web using Google\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"q\": {\n              \"type\": \"string\",\n              \"description\": \"Search query\"\n            },\n            \"num\": {\n              \"type\": \"integer\",\n              \"description\": \"Number of results\"\n            }\n          },\n          \"required\": [\"q\"]\n        }\n      }\n    }\n  ],\n  \"stream\": false\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Response created with tool call', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.expect(response).to.have.property('id');",
                  "  pm.collectionVariables.set('response_id', response.id);",
                  "});",
                  "pm.test('Tool was executed', function () {",
                  "  // Response should contain tool execution metadata",
                  "  pm.expect(response.output).to.exist;",
                  "});",
                  "pm.test('Response contains search results', function () {",
                  "  const outputText = JSON.stringify(response.output).toLowerCase();",
                  "  pm.expect(outputText).to.satisfy(function(text) {",
                  "    return text.includes('openai') || text.includes('search') || text.includes('result');",
                  "  });",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "5. Tool Calling - Multi-Step",
      "item": [
        {
          "name": "Search and Scrape Chain",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Search for the official OpenAI website, then scrape the homepage and tell me what's their main product\",\n  \"tools\": [\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"google_search\",\n        \"description\": \"Search the web\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\"q\": {\"type\": \"string\"}},\n          \"required\": [\"q\"]\n        }\n      }\n    },\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"scrape\",\n        \"description\": \"Scrape webpage content\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"url\": {\"type\": \"string\", \"description\": \"URL to scrape\"}\n          },\n          \"required\": [\"url\"]\n        }\n      }\n    }\n  ],\n  \"stream\": false\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Multi-step tool execution completed', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.expect(response.status).to.equal('completed');",
                  "});",
                  "pm.test('Response contains final answer', function () {",
                  "  pm.expect(response.output).to.exist;",
                  "  const outputText = JSON.stringify(response.output).toLowerCase();",
                  "  pm.expect(outputText.length).to.be.greaterThan(50);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "6. Tool Calling - File Search",
      "item": [
        {
          "name": "Index Document",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Index this document: OpenAI released GPT-4 in March 2023. It's a large multimodal model.\",\n  \"tools\": [\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"file_search_index\",\n        \"description\": \"Index text for search\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"document_id\": {\"type\": \"string\"},\n            \"text\": {\"type\": \"string\"},\n            \"metadata\": {\"type\": \"object\"}\n          },\n          \"required\": [\"document_id\", \"text\"]\n        }\n      }\n    }\n  ],\n  \"stream\": false\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Document indexed', function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Query Indexed Documents",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"When was GPT-4 released? Search my indexed documents.\",\n  \"tools\": [\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"file_search_query\",\n        \"description\": \"Query indexed documents\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"query\": {\"type\": \"string\"},\n            \"top_k\": {\"type\": \"integer\"}\n          },\n          \"required\": [\"query\"]\n        }\n      }\n    }\n  ],\n  \"stream\": false\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('File search executed', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Response mentions GPT-4', function () {",
                  "  const outputText = JSON.stringify(response.output).toLowerCase();",
                  "  pm.expect(outputText).to.include('gpt-4');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "7. Conversation Continuity",
      "item": [
        {
          "name": "Create Response with Conversation",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"My name is Alice and I live in Paris\",\n  \"stream\": false\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Response created', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.collectionVariables.set('response_id', response.id);",
                  "  if (response.conversation) {",
                  "    pm.collectionVariables.set('conversation_id', response.conversation.id);",
                  "  }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Continue from Previous Response",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"What's my name and where do I live?\",\n  \"previous_response_id\": \"{{response_id}}\",\n  \"stream\": false\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Conversation continued', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Response remembers context', function () {",
                  "  const outputText = JSON.stringify(response.output).toLowerCase();",
                  "  pm.expect(outputText).to.include('alice');",
                  "  pm.expect(outputText).to.include('paris');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "8. Error Handling",
      "item": [
        {
          "name": "Invalid Tool Name",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Use the invalid_tool\",\n  \"tools\": [\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"invalid_tool_that_does_not_exist\",\n        \"description\": \"Non-existent tool\",\n        \"parameters\": {\"type\": \"object\", \"properties\": {}}\n      }\n    }\n  ],\n  \"stream\": false\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Handles invalid tool gracefully', function () {",
                  "  // Should either return error or complete without tool",
                  "  pm.expect(pm.response.code).to.be.oneOf([200, 400, 422]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Missing Required Parameters",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"input\": \"Test without model\",\n  \"stream\": false\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validates required fields', function () {",
                  "  pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Cancel Response",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{response_id}}/cancel"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Cancel endpoint exists', function () {",
                  "  pm.expect(pm.response.code).to.be.oneOf([200, 404, 409]);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "9. Complex Scenario",
      "item": [
        {
          "name": "Search, Scrape, Analyze Chain",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Search for recent AI news, scrape the top result, and execute Python code to count how many times 'AI' appears in the content\",\n  \"tools\": [\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"google_search\",\n        \"description\": \"Search the web\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\"q\": {\"type\": \"string\"}},\n          \"required\": [\"q\"]\n        }\n      }\n    },\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"scrape\",\n        \"description\": \"Scrape webpage\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\"url\": {\"type\": \"string\"}},\n          \"required\": [\"url\"]\n        }\n      }\n    },\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"python_exec\",\n        \"description\": \"Execute Python code\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"code\": {\"type\": \"string\"},\n            \"language\": {\"type\": \"string\"}\n          },\n          \"required\": [\"code\"]\n        }\n      }\n    }\n  ],\n  \"stream\": false\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Complex tool chain executed', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.expect(response.status).to.equal('completed');",
                  "});",
                  "pm.test('Response contains analysis', function () {",
                  "  pm.expect(response.output).to.exist;",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "10. Basic Background Mode",
      "item": [
        {
          "name": "Create Background Response",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Write a detailed analysis of the history of space exploration, covering major milestones from the 1950s to present day.\",\n  \"background\": true,\n  \"store\": true\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Background response created', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.expect(response).to.have.property('id');",
                  "  pm.expect(response).to.have.property('status');",
                  "  pm.collectionVariables.set('background_response_id', response.id);",
                  "});",
                  "pm.test('Status is queued or in_progress', function () {",
                  "  pm.expect(response.status).to.be.oneOf(['queued', 'in_progress']);",
                  "});",
                  "pm.test('Response has no output yet', function () {",
                  "  // Background responses should not have output immediately",
                  "  if (response.output) {",
                  "    pm.expect(response.output).to.be.empty;",
                  "  }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Poll Background Response",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{background_response_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Response retrieved', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.expect(response.id).to.equal(pm.collectionVariables.get('background_response_id'));",
                  "});",
                  "pm.test('Status is valid', function () {",
                  "  pm.expect(response.status).to.be.oneOf(['queued', 'in_progress', 'completed', 'failed', 'cancelled']);",
                  "});",
                  "// Log current status for debugging",
                  "console.log('Current status: ' + response.status);",
                  "",
                  "// If completed, verify output exists",
                  "if (response.status === 'completed') {",
                  "  pm.test('Completed response has output', function () {",
                  "    pm.expect(response.output).to.exist;",
                  "  });",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Wait and Poll Again (2s)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{background_response_id}}"
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Wait 2 seconds before polling",
                  "setTimeout(function(){}, 2000);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Response still accessible', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "console.log('Status after 2s: ' + response.status);"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "11. Background with Webhooks",
      "item": [
        {
          "name": "Create Background Response with Webhook",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Generate a comprehensive guide to machine learning algorithms with examples.\",\n  \"background\": true,\n  \"store\": true,\n  \"metadata\": {\n    \"webhook_url\": \"{{webhook_url}}\",\n    \"webhook_events\": [\"response.completed\", \"response.failed\"]\n  }\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Background response with webhook created', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.expect(response).to.have.property('id');",
                  "  pm.collectionVariables.set('background_response_id', response.id);",
                  "});",
                  "pm.test('Initial status is queued or in_progress', function () {",
                  "  pm.expect(response.status).to.be.oneOf(['queued', 'in_progress']);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify Webhook Metadata",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{background_response_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Response has metadata', function () {",
                  "  pm.expect(response).to.have.property('metadata');",
                  "});",
                  "pm.test('Webhook URL stored in metadata', function () {",
                  "  if (response.metadata) {",
                  "    pm.expect(response.metadata.webhook_url).to.exist;",
                  "  }",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "12. Background with Tool Calling",
      "item": [
        {
          "name": "Background Response with Google Search",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Search for the latest developments in quantum computing and provide a detailed summary with sources.\",\n  \"background\": true,\n  \"store\": true,\n  \"tools\": [\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"google_search\",\n        \"description\": \"Search the web using Google\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"q\": {\n              \"type\": \"string\",\n              \"description\": \"Search query\"\n            },\n            \"num\": {\n              \"type\": \"integer\",\n              \"description\": \"Number of results\"\n            }\n          },\n          \"required\": [\"q\"]\n        }\n      }\n    }\n  ]\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Background response with tools created', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.expect(response).to.have.property('id');",
                  "  pm.collectionVariables.set('background_response_id', response.id);",
                  "});",
                  "pm.test('Tools accepted', function () {",
                  "  pm.expect(response.status).to.be.oneOf(['queued', 'in_progress']);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Poll Tool Execution Progress",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{background_response_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Tool execution trackable', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "// Check if tool execution metadata exists",
                  "if (response.metadata && response.metadata.tool_calls) {",
                  "  console.log('Tool calls detected: ' + JSON.stringify(response.metadata.tool_calls));",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Background Multi-Step Tool Chain",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Search for the OpenAI homepage, scrape its content, and analyze the main products mentioned.\",\n  \"background\": true,\n  \"store\": true,\n  \"tools\": [\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"google_search\",\n        \"description\": \"Search the web\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\"q\": {\"type\": \"string\"}},\n          \"required\": [\"q\"]\n        }\n      }\n    },\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"scrape\",\n        \"description\": \"Scrape webpage content\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\"url\": {\"type\": \"string\"}},\n          \"required\": [\"url\"]\n        }\n      }\n    }\n  ]\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Multi-step background task created', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.collectionVariables.set('background_response_id', response.id);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "13. Background Cancellation",
      "item": [
        {
          "name": "Create Long-Running Background Task",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Write a comprehensive 10,000 word essay on the history of artificial intelligence, including detailed examples, citations, and analysis.\",\n  \"background\": true,\n  \"store\": true\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Long-running task created', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.collectionVariables.set('background_response_id', response.id);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Cancel Background Response",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{background_response_id}}/cancel"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Cancel request accepted', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Status is cancelled or terminal', function () {",
                  "  pm.expect(response.status).to.be.oneOf(['cancelled', 'completed', 'failed']);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Cancel Again (Idempotent)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{background_response_id}}/cancel"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Idempotent cancellation', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Returns final state', function () {",
                  "  const response = pm.response.json();",
                  "  pm.expect(response).to.have.property('status');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify Cancelled Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{background_response_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Cancelled response persists', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.expect(response.status).to.equal('cancelled');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "14. Background Conversation Continuity",
      "item": [
        {
          "name": "Background Response with Context",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"My name is Sarah and I'm a software engineer working on AI systems.\",\n  \"background\": true,\n  \"store\": true\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Context response created', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.collectionVariables.set('background_response_id', response.id);",
                  "});",
                  "if (response.conversation) {",
                  "  pm.collectionVariables.set('conversation_id', response.conversation.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Wait for First Response",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{background_response_id}}"
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Wait for completion",
                  "setTimeout(function(){}, 3000);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('First response status checked', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "console.log('Status: ' + response.status);"
                ]
              }
            }
          ]
        },
        {
          "name": "Continue Conversation in Background",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"What's my name and profession? Please provide a detailed response.\",\n  \"previous_response_id\": \"{{background_response_id}}\",\n  \"background\": true,\n  \"store\": true\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Continuation created', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.collectionVariables.set('background_response_id', response.id);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Poll Continuation Response",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{background_response_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Continuation trackable', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "// When completed, check if context was maintained",
                  "if (response.status === 'completed') {",
                  "  pm.test('Context maintained', function () {",
                  "    const outputText = JSON.stringify(response.output).toLowerCase();",
                  "    pm.expect(outputText).to.satisfy(function(text) {",
                  "      return text.includes('sarah') || text.includes('engineer');",
                  "    });",
                  "  });",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "15. Background Error Handling",
      "item": [
        {
          "name": "Background Without Store (Should Fail)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Test background without store\",\n  \"background\": true,\n  \"store\": false\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Rejects background without store', function () {",
                  "  // Per OpenAI docs: background requires store=true",
                  "  pm.expect(pm.response.code).to.be.oneOf([400, 422]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Poll Non-Existent Background Response",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/resp_nonexistent123"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Returns 404 for missing response', function () {",
                  "  pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Cancel Non-Existent Background Response",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/resp_nonexistent123/cancel"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Returns error for missing response', function () {",
                  "  pm.expect(pm.response.code).to.be.oneOf([404, 400]);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "16. Complex Background Scenarios",
      "item": [
        {
          "name": "Parallel Background Tasks",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Analyze the differences between neural networks and decision trees in machine learning.\",\n  \"background\": true,\n  \"store\": true,\n  \"metadata\": {\n    \"task_id\": \"parallel_1\",\n    \"webhook_url\": \"{{webhook_url}}\"\n  }\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('First parallel task created', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "pm.environment.set('parallel_task_1', response.id);"
                ]
              }
            }
          ]
        },
        {
          "name": "Background with Multiple Tools",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Research the latest AI breakthroughs, scrape relevant articles, and write Python code to analyze the word frequency of 'neural network' across all sources.\",\n  \"background\": true,\n  \"store\": true,\n  \"tools\": [\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"google_search\",\n        \"description\": \"Search the web\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\"q\": {\"type\": \"string\"}},\n          \"required\": [\"q\"]\n        }\n      }\n    },\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"scrape\",\n        \"description\": \"Scrape webpage\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\"url\": {\"type\": \"string\"}},\n          \"required\": [\"url\"]\n        }\n      }\n    },\n    {\n      \"type\": \"function\",\n      \"function\": {\n        \"name\": \"python_exec\",\n        \"description\": \"Execute Python code\",\n        \"parameters\": {\n          \"type\": \"object\",\n          \"properties\": {\"code\": {\"type\": \"string\"}},\n          \"required\": [\"code\"]\n        }\n      }\n    }\n  ],\n  \"metadata\": {\n    \"webhook_url\": \"{{webhook_url}}\",\n    \"complexity\": \"high\"\n  }\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Complex multi-tool background task created', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.collectionVariables.set('background_response_id', response.id);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Poll Complex Task Progress",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{background_response_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Complex task progressing', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "console.log('Status: ' + response.status);",
                  "if (response.metadata) {",
                  "  console.log('Metadata: ' + JSON.stringify(response.metadata));",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "17. Background Monitoring & Observability",
      "item": [
        {
          "name": "Create Monitored Background Task",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Generate a detailed technical specification for a REST API.\",\n  \"background\": true,\n  \"store\": true,\n  \"metadata\": {\n    \"trace_id\": \"test-trace-001\",\n    \"user_id\": \"test-user\",\n    \"priority\": \"high\",\n    \"webhook_url\": \"{{webhook_url}}\"\n  }\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Monitored task created', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.collectionVariables.set('background_response_id', response.id);",
                  "});",
                  "pm.test('Trace metadata preserved', function () {",
                  "  if (response.metadata) {",
                  "    pm.expect(response.metadata.trace_id).to.equal('test-trace-001');",
                  "  }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Check Response Timing",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{background_response_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Timing metadata exists', function () {",
                  "  pm.expect(response).to.have.property('created_at');",
                  "});",
                  "if (response.status === 'completed') {",
                  "  pm.test('Completion time recorded', function () {",
                  "    pm.expect(response).to.have.property('completed_at');",
                  "  });",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "18. Long-Running Research Task",
      "item": [
        {
          "name": "Create Long Research Task",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"model\": \"{{default_model_id}}\",\n  \"input\": \"Research the economic impact of semaglutide on global healthcare systems.\\nDo:\\n- Include specific figures, trends, statistics, and measurable outcomes.\\n- Prioritize reliable, up-to-date sources: peer-reviewed research, health organizations (e.g., WHO, CDC), regulatory agencies, or pharmaceutical earnings reports.\\n- Include inline citations and return all source metadata.\\n\\nBe analytical, avoid generalities, and ensure that each section supports data-backed reasoning that could inform healthcare policy or financial modeling.\",\n  \"background\": true,\n  \"store\": true,\n  \"metadata\": {\n    \"task_type\": \"research\",\n    \"complexity\": \"very_high\",\n    \"estimated_duration\": \"long\",\n    \"webhook_url\": \"{{webhook_url}}\"\n  }\n}"
            },
            "url": "{{kong_url}}/responses/v1/responses"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Long research task created', function () {",
                  "  pm.response.to.have.status(200);",
                  "  pm.expect(response.background).to.be.true;",
                  "  pm.expect(response.store).to.be.true;",
                  "  pm.collectionVariables.set('long_task_response_id', response.id);",
                  "});",
                  "pm.test('Task metadata preserved', function () {",
                  "  pm.expect(response.metadata).to.have.property('task_type', 'research');",
                  "  pm.expect(response.metadata).to.have.property('complexity', 'very_high');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Poll Long Task Status (Initial)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{long_task_response_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Long task is processing', function () {",
                  "  pm.response.to.have.status(200);",
                  "  const validStatuses = ['queued', 'in_progress', 'completed'];",
                  "  pm.expect(validStatuses).to.include(response.status);",
                  "});",
                  "console.log('Long task status: ' + response.status);",
                  "console.log('Task ID: ' + response.id);"
                ]
              }
            }
          ]
        },
        {
          "name": "Wait and Poll Long Task (10s)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{long_task_response_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Task is progressing or completed', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "console.log('Status after delay: ' + response.status);",
                  "if (response.status === 'completed' && response.output) {",
                  "  console.log('Task completed with output length: ' + JSON.stringify(response.output).length + ' chars');",
                  "}",
                  "if (response.status === 'failed' && response.error) {",
                  "  console.log('Task failed with error: ' + JSON.stringify(response.error));",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Final Status Check",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guest_access_token}}"
              }
            ],
            "url": "{{kong_url}}/responses/v1/responses/{{long_task_response_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const response = pm.response.json();",
                  "pm.test('Long task has terminal status', function () {",
                  "  pm.response.to.have.status(200);",
                  "  const terminalStatuses = ['completed', 'failed', 'cancelled'];",
                  "  const inProgressStatuses = ['queued', 'in_progress'];",
                  "  const allStatuses = [...terminalStatuses, ...inProgressStatuses];",
                  "  pm.expect(allStatuses).to.include(response.status);",
                  "});",
                  "console.log('Final status: ' + response.status);",
                  "if (response.usage) {",
                  "  console.log('Token usage: ' + JSON.stringify(response.usage));",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    }
  ]
}
